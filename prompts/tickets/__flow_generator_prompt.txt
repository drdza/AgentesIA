Tu tarea es analizar una pregunta en lenguaje natural relacionada con la tabla `ft_tickets_ia` y generar una lista clara, secuencial y bien estructurada de pasos que expliquen cÃ³mo resolverla en SQL. No escribas el SQL directamente. Solo describe cÃ³mo se debe construir.

---

### ðŸŽ¯ **Objetivo**:
- Entrega entre 2 y 6 pasos tÃ©cnicos ordenados.
- Cada paso debe iniciar con un verbo (Ej: Filtrar, Agrupar, Calcular, Seleccionar).
- Detalla campos, condiciones y funciones necesarias.

---

### ðŸ“˜ **Esquema disponible (`ft_tickets_ia`)**:

- fecha_registro (date): Fecha en la que se registrÃ³ el ticketde tipo fecha.
- anio_registro (int): AÃ±o en el que se registrÃ³ el ticket en formato nÃºmerico.
- mes_registro (int): Numero del mes en el que se registrÃ³ el ticket.
- fecha_cierre (date): Fecha en la que sÃ© cerrÃ³ (se atendiÃ³) el ticket de tipo fecha.
- estatus_ticket (text): Estado actual del ticket, posibles valores: ATENDIDO, EN PROCESO, CANCELADO, AUTORIZACIÃ“N, MESA DE AYUDA.
- folio_ticket (int): Numero Ãºnico del ticket.
- sistema (text): Plataforma donde se registra el ticket, INNOVAPP es una app movil, BUSINESS SUITE es una plataforma de escritorio.
- motivo_ticket (text): DescripciÃ³n del usuario del porque regsitrÃ³ el ticket, peticiÃ³n del usuario.
- motivo_cierre_ticket (text): DescricpicÃ³n del porque se atendiÃ³ el ticket, informaciÃ³n que ingresa el colaborador.
- servicio_cierre_ticket (text): Nombre del servicio bajo el cual se ha atendido el ticket, lo asigna el colaborador. 
- centro_trabajo (text): Lugar donde se reporta el ticket, lugar de trabajo del usuario.
- ciudad (text): Ciudad donde se reporta el ticket, ciudad de trabajo del usuario.
- empresa (text): Empresa a la que pertence el usuario que registra el ticket.
- unidad_negocio (text): Unidad de negocio a la que pertenece el usuario que registra el ticket.
- personal_reporta (text): Persona que registra el ticket.
- colaborador_asignado (text): Persona o colaborador que ha atendido o atiende el ticket.
- departamento_colaborador_asignado (text): Departamento del personal que tiene asignado el ticket.
- area_colaborador_asignado (text): Ãrea del personal que tiene asignado el ticket.
- servicio (text): Servicio actual del ticket.
- tiempo_solucion_total (numeric, en segundos): Tiempo de atenciÃ³n total del ticket.
- tiempo_sla_servicio (numeric, en segundos): Tiempo total del servicio (SLA).

---

### ðŸ“Œ **Reglas importantes**:
- ðŸš« Nunca uses funciones inexistentes como CURRENT_YEAR, CURRENT_MONTH, TODAY o similares. 
- âœ… Si necesitas el aÃ±o actual, usa EXTRACT(YEAR FROM CURRENT_DATE) o el campo anio_registro si ya existe.
- âœ… Si el esquema ya tiene campos como anio_registro o mes_registro, deben usarse directamente para evitar funciones sobre fecha_registro.
- âœ… Compara texto con `ILIKE '%valor%'` en lugar de `=`.
- Si la pregunta implica comparar subconjuntos (como tickets dentro o fuera del SLA, o atendidos en menos de cierto tiempo), no filtres directamente en el WHERE. 
   - Primero agrupa o cuenta todo el universo y luego aplica la condiciÃ³n dentro del SELECT usando:
    - COUNT(*) FILTER (WHERE ...)
    - AVG(...) FILTER (WHERE ...)
    - CASE WHEN ... THEN ... ELSE ... END

### ðŸ’¡ **Consejo**:
- Solo usa el WHERE para filtrar dimensiones generales (como aÃ±o, empresa, o tipo de servicio). 
- Nunca uses WHERE si eso elimina informaciÃ³n necesaria para una comparaciÃ³n posterior.

---

### ðŸ› ï¸ **Instrucciones clave**:

1. **Aplica lÃ³gica secuencial**:
   - Primero los filtros generales (`WHERE`)
   - Luego identifica los filtros a subgrupos COUNT(*) FILTER (WHERE ...)
   - Luego agrupaciones (`GROUP BY`)
   - Luego cÃ¡lculos (`AVG`, `COUNT`, `RANK`, etc.)
   - Finalmente proyecciones y ordenamiento

2. **Traduce tÃ©rminos comunes**:
   - "cerrado", "resuelto" â†’ `estatus_ticket ILIKE '%ATENDIDO%'`
   - "en proceso", "pendiente" â†’ `estatus_ticket ILIKE '%EN PROCESO%'`
   - "fuera del SLA" â†’ `tiempo_solucion_total > tiempo_sla_servicio`
   - "dentro del SLA" â†’ `tiempo_solucion_total <= tiempo_sla_servicio`
   - "sin fecha" â†’ usar `IS NULL`

3. **Si se requiere ranking por grupo (mejores o peores por grupo), usa**:
   - Funciones como `ROW_NUMBER()` con `PARTITION BY`
   - Puedes indicar el uso de `WITH` si mejora la estructura   

4. **Porcentajes generales**:
   - Paso 1: Calcular el total con `COUNT(*)`
   - Paso 2: Calcular el subconjunto con `COUNT(*) FILTER (WHERE ...)`
   - Paso 3: Calcular `(parte / total) * 100`
   - Paso 4: Para evitar divisiones por cero, usa `NULLIF(...)` en el denominador

5. **CÃ¡lculos con fechas**:
   - Para obtener el mes: `EXTRACT(MONTH FROM fecha_registro)`
   - Para obtener el aÃ±o: `EXTRACT(YEAR FROM fecha_registro)`
   - Para calcular dÃ­as transcurridos: `CURRENT_DATE - fecha_registro`
   - Si se usan varias fechas, incluye operaciones como `fecha_cierre - fecha_registro`

6. **Porcentajes por grupo (dentro de grupo)**:
   - Paso 1: Filtrar registros base con `WHERE` (ej. solo los ATENDIDOS)
   - Paso 2: Agrupar por grupo deseado (ej. departamento)
   - Paso 3: Usar `COUNT(*)` como total por grupo
   - Paso 4: Usar `COUNT(*) FILTER (WHERE ...)` como parcial dentro del grupo
   - Paso 5: Dividir y multiplicar por 100 â†’ `(parcial::float / NULLIF(total, 0)) * 100`

---

### âœï¸ **Ejemplo**:

Pregunta: "Â¿QuÃ© colaborador tiene peor promedio por departamento en 2024?"

Salida esperada:
1. Filtrar tickets del aÃ±o 2024 con estatus ATENDIDO.
2. Agrupar por departamento y colaborador.
3. Calcular `AVG(tiempo_solucion_total)` por cada colaborador.
4. Generar un ranking por cada departamento (`ROW_NUMBER()`).
5. Seleccionar solo los registros con ranking = 1.

---

###  ðŸ“ Pregunta del usuario:
{question}
